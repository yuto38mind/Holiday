<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Holiday Letter</title>
<style>
  :root{
    --bg1:#0b1020; --bg2:#1a2444;
    --card: rgba(10,14,28,.45);
    --border: rgba(255,255,255,.14);
    --shadow: 0 18px 50px rgba(0,0,0,.35);
    --text:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,
    "Hiragino Kaku Gothic ProN","Yu Gothic","Noto Sans JP",sans-serif;
  background: #ffffff;   /* ← 最初は白 */
  color:#111;
  overflow:hidden;
  transition: background 1s ease, color 1s ease;
  }
  body.night{
  background: linear-gradient(#0b1020, #1a2444);
  color:#fff;
  }

  .scene{
    position:relative;
    width:100%;
    height:100vh;
    height:100dvh;
  }

  /* ===== 桜（花びら）：まっすぐ落とす ===== */
  .petals{
    position:absolute; inset:0;
    pointer-events:none;
    opacity: 0;                 /* ← 最初は見せない */
    overflow:hidden;
  }
  .petal{
    position:absolute;
    top:-10vh;
    width:14px; height:10px;
    background: radial-gradient(circle at 30% 30%, #ffd1dc 0%, #ffb7c5 35%, #ff9fb2 70%, #ff8aa2 100%);
    border-radius: 80% 20% 80% 20%;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,.25));
    /* 横に揺らさず、縦に落ちる＋軽い回転だけ */
    animation:
      fallStraight var(--fallDur) linear var(--delay) infinite,
      spin var(--spinDur) ease-in-out var(--delay) infinite;
  }

  
  @keyframes fallStraight{
    from{ transform: translateY(-10vh); }
    to  { transform: translateY(110vh); }
  }
  @keyframes spin{
    0%,100%{ rotate: 10deg }
    50%{ rotate: -18deg }
  }
  @media (prefers-reduced-motion: reduce){
    .petal{ display:none; }
  }

  /* ===== 写真シーケンス ===== */
  .stack{
    position:absolute;
    left:50%;
    top:14vh;
    transform: translateX(-50%);
    width:min(920px,92vw);
    display:flex;
    gap:14px;
    justify-content:center;
    align-items:stretch;
  }
 .photo{
  flex:1;
  min-width:0;
  aspect-ratio: 3 / 4;

  background: none;
  border: 0;
  box-shadow: none;

  overflow: visible; /* トコトコ用 */
  position: relative;

  opacity: 0;
  transform: translateY(12px);
  transition: opacity .9s ease, transform .9s ease;
  }

  .photo.show{ opacity:1; transform: translateY(0); }
  .photo.hide{ opacity:0; transform: translateY(16px); }

  .photo .frame{
    overflow: visible;
  }

  .photo .frame img{
    width:100%;
    height:100%;
    object-fit: cover;
    display:block;
  }

  .photo .frame::after{ display:none; }

  /* ===== トコトコ：写真の外側（枠外）に表示 ===== */
  .photo .toko{
  position: absolute;
  left: calc(100% + 12px);
  top: 50%;
  transform: translateY(-50%);

  font-weight: 800;
  letter-spacing: .06em;
  white-space: nowrap;

  opacity: 0;

  transition:
    opacity .6s ease,
    transform .6s ease;

  transition-delay: .4s;  /* ← ここ。0.4秒後に出る */
  }

  .photo.show .toko{
    opacity: 1;
  }
  .photo.hide .toko{
    opacity: 0;
    transform: translateX(-50%) translateY(8px);
  }
  /*show up sakura*/
  .petals.show{
    opacity: 1;
  }
  /* ===== 封筒（手紙）：白い封筒 ===== */
  .letterWrap{
    position:absolute;
    left:50%;
    bottom:10vh;
    transform: translateX(-50%);
    width:min(520px,90vw);
    display:flex;
    justify-content:center;
    opacity:0;
    transform-origin:center;
    transition: opacity .8s ease, transform .8s cubic-bezier(.2,.8,.2,1);
  }
  .letterWrap.show{
    opacity:1;
    transform: translateX(-50%) translateY(0);
  }
  .envelope{
    width:100%;
    aspect-ratio: 16 / 10;
    position:relative;
    cursor:pointer;
    user-select:none;
    border-radius:22px;
    box-shadow: var(--shadow);
    outline:none;
  }

  .env-back{
    position:absolute; inset:0;
    background: rgba(255,255,255,.88);
    border: 1px solid rgba(0,0,0,.10);
    border-radius:22px;
  }
  .env-front{
  position:absolute;
  inset:0;
  border-radius:22px;
  overflow:hidden;
}

/* 上の四角い部分 */
.env-front::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  width:100%;
  height:100%;                /* 上は常に固定 */
  background: rgba(0,0,0,.06);
}

/* 下の谷（三角） */
.env-front::after{
  content:"";
  position:absolute;
  left:0;
  top:0%;                   /* 上の続き */
  width:100%;
  height:70%;
  background: rgba(0,0,0,.06);

  clip-path: polygon(
    0 0,
    100% 0,
    50% 100%
  );
}


  .seal{
    position:absolute;
    left:50%; top:55%;
    transform: translate(-50%,-50%);
    width:64px; height:64px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #ffffff, #f2f2f2 70%, #e7e7e7);
    border:1px solid rgba(0,0,0,.10);
    box-shadow: 0 10px 25px rgba(0,0,0,.20);
    display:grid;
    place-items:center;
    font-weight:900;
    letter-spacing:.08em;
    color:#111;
  }
  .hint{
    position:absolute;
    left:50%;
    top:10%;
    transform:translateX(-50%);
    font-weight:800;
    color:#111;
    opacity:.88;
    text-align:center;
    width:90%;
    text-shadow:none;
  }
  .hint small{display:block; opacity:.70; font-weight:700; margin-top:.25em}

  .envelope:focus-visible{
    outline: 3px solid rgba(255,255,255,.55);
    outline-offset: 4px;
  }

  /* ===== 開封後：16:9 の白い新画面（オーバーレイ） ===== */
  .overlay{
    position:fixed;
    inset:0;
    display:grid;
    place-items:center;
    background: rgba(0,0,0,.35);
    opacity:0;
    pointer-events:none;
    transition: opacity .35s ease;
  }
  .overlay.show{
    opacity:1;
    pointer-events:auto;
  }
  .paper169{
    width:min(92vw, 980px);
    aspect-ratio: 16 / 9;
    background:#fff;
    color:#111;
    border-radius:20px;
    box-shadow: 0 28px 80px rgba(0,0,0,.35);
    position:relative;
    overflow:hidden;
    transform: scale(.96);
    opacity:0;
    transition: transform .45s ease, opacity .45s ease;
  }
  .overlay.show .paper169{
    transform: scale(1);
    opacity:1;
  }

  /* 開封時のエフェクト（シンプルなキラッ） */
  .sparkle{
    position:absolute;
    inset:-20%;
    background:
      radial-gradient(circle at 20% 30%, rgba(255,255,255,.85), transparent 38%),
      radial-gradient(circle at 70% 60%, rgba(255,255,255,.65), transparent 42%),
      radial-gradient(circle at 45% 25%, rgba(255,255,255,.55), transparent 40%);
    opacity:0;
    transform: scale(.95);
    pointer-events:none;
  }
  .overlay.show .sparkle{
    animation: sparkleIn .55s ease forwards;
  }
  @keyframes sparkleIn{
    0%{opacity:0; transform:scale(.95)}
    40%{opacity:.85}
    100%{opacity:0; transform:scale(1.05)}
  }

  .paperInner{
    position:absolute;
    inset:0;
    padding: 26px 26px;
    display:flex;
    flex-direction:column;
    gap:14px;
  }
  .paperTitle{
    margin:0;
    font-size: clamp(18px, 2.6vw, 26px);
    letter-spacing:.02em;
  }
  .paperText{
    flex:1;
    font-size: clamp(16px, 2.2vw, 20px);
    line-height:1.75;
    white-space:pre-wrap;
    overflow:auto;
    padding-right:6px;
  }
  .paperActions{
    display:flex;
    justify-content:center;
    gap:10px;
  }
  .paperActions button{
    border:0;
    padding:10px 14px;
    border-radius:999px;
    background:#111;
    color:#fff;
    font-weight:800;
    cursor:pointer;
  }
</style>
</head>
<body>
<div class="scene" id="scene">
  <div class="petals" id="petals" aria-hidden="true"></div>

  <div class="stack" aria-label="写真スライド">
    <div class="photo" id="p1">
      <div class="frame">
        <img src="assets/photo1.jpg" alt="photo 1">
      </div>
      <div class="toko">トコトコ</div>
    </div>

    <div class="photo" id="p2">
      <div class="frame">
        <img src="assets/photo2.jpg" alt="photo 2">
      </div>
      <div class="toko">トコトコ</div>
    </div>

    <div class="photo" id="p3">
      <div class="frame">
        <img src="assets/photo3.jpg" alt="photo 3">
      </div>
      <div class="toko">トコトコ</div>
    </div>
  </div>

  <div class="letterWrap" id="letterWrap">
    <div class="envelope" id="envelope" role="button" tabindex="0" aria-label="手紙を開く">
      <div class="env-back"></div>
      <div class="env-front"></div>
      <div class="seal">OPEN</div>
      <div class="hint" id="hint">
        手紙をタップして開いてね
        <small>aaaaa</small>
      </div>
    </div>
  </div>
</div>

<!-- 開封後の白い16:9画面 -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="paper169" role="dialog" aria-label="メッセージ">
    <div class="sparkle"></div>
    <div class="paperInner">
      <h1 class="paperTitle" id="paperTitle">Message</h1>
      <div class="paperText" id="paperText"></div>
      <div class="paperActions">
        <button type="button" id="closeOverlay">閉じる</button>
      </div>
    </div>
  </div>
</div>

<script>
  // ===== 好きに書き換える場所 =====
  const MESSAGE = "昨年はありがとうございました。\n\n今年もどうぞよろしくお願いします。\n健康で無事故の良い一年になりますように。";
  const SIGN    = "木村家一同より"; // 不要なら ""
  const TITLE   = "本年もよろしくお願いいたします。";
  const PHOTO_DELAY = 2000;   // 写真が出る間隔（ms）
  const VISIBLE_MS  = 2200;   // 表示している時間（ms）
  const PETAL_COUNT = 26;     // 花びら量（端末が重ければ下げる）
  // ===============================

  // 桜を生成（まっすぐ落下）
  const petals = document.getElementById("petals");
  if(!matchMedia("(prefers-reduced-motion: reduce)").matches){
    for(let i=0;i<PETAL_COUNT;i++){
      const p=document.createElement("div");
      p.className="petal";
      // 位置は横だけランダム。落ちは縦のみ。
      p.style.left = (Math.random()*100) + "vw";
      p.style.setProperty("--fallDur", (8 + Math.random()*10) + "s");
      p.style.setProperty("--spinDur", (2.8 + Math.random()*2.6) + "s");
      p.style.setProperty("--delay", (-Math.random()*10) + "s");
      p.style.opacity = (0.45 + Math.random()*0.4).toFixed(2);
      p.style.transform = `scale(${(0.7+Math.random()*1.2).toFixed(2)})`;
      petals.appendChild(p);
    }
  }

  // 写真：要素取得
  const p1 = document.getElementById("p1");
  const p2 = document.getElementById("p2");
  const p3 = document.getElementById("p3");
  const letterWrap = document.getElementById("letterWrap");

  // 初期化
  [p1,p2,p3].forEach(el => el.classList.remove("show","hide"));

  function showThenHide(el, showDelay, visibleMs = VISIBLE_MS){
    setTimeout(() => {
      el.classList.add("show");
      el.classList.remove("hide");
    }, showDelay);

    setTimeout(() => {
      el.classList.add("hide");
      el.classList.remove("show");
    }, showDelay + visibleMs);
  }

  // 右から順に表示：p3 → p2 → p1
  showThenHide(p3, 200);
  showThenHide(p2, 200 + PHOTO_DELAY);
  showThenHide(p1, 200 + PHOTO_DELAY*2);

  // 手紙は最後に出す
  setTimeout(() => {
  letterWrap.classList.add("show");

  // 背景を切り替える
  document.body.classList.add("night");

  // 桜を表示開始
  document.getElementById("petals").classList.add("show");
  }, 200 + PHOTO_DELAY*3);


  // ===== 開封後のオーバーレイ（白い16:9） =====
  const overlay = document.getElementById("overlay");
  const envelope = document.getElementById("envelope");
  const paperText = document.getElementById("paperText");
  const paperTitle = document.getElementById("paperTitle");
  const closeOverlay = document.getElementById("closeOverlay");
  const hint = document.getElementById("hint");

  paperTitle.textContent = TITLE;
  const fullText = SIGN ? (MESSAGE + "\n\n" + SIGN) : MESSAGE;

  function typewriter(el, text, ms=18){
    el.textContent = "";
    let i = 0;
    const id = setInterval(() => {
      el.textContent = text.slice(0, ++i);
      if(i >= text.length) clearInterval(id);
    }, ms);
    return id;
  }

  let opened = false;
  let typingId = null;

  function openLetter(){
    if(opened) return;
    opened = true;
    hint.style.display = "none";
    overlay.classList.add("show");
    overlay.setAttribute("aria-hidden","false");
    typingId = typewriter(paperText, fullText, 18);
  }

  function closeLetter(){
    opened = false;
    if(typingId) clearInterval(typingId);
    overlay.classList.remove("show");
    overlay.setAttribute("aria-hidden","true");
    hint.style.display = "";
    paperText.textContent = "";
  }

  envelope.addEventListener("click", () => openLetter());
  envelope.addEventListener("keydown", (e) => {
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      openLetter();
    }
  });

  closeOverlay.addEventListener("click", (e) => {
    e.stopPropagation();
    closeLetter();
  });

  overlay.addEventListener("click", (e) => {
    // 背景クリックで閉じる（紙の上は除外）
    if(e.target === overlay) closeLetter();
  });

  document.addEventListener("keydown", (e) => {
    if(e.key === "Escape" && opened) closeLetter();
  });
</script>
</body>
</html>




















