<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Holiday Letter</title>
<style>
  :root{
    --bg1:#0b1020; --bg2:#1a2444;
    --card: rgba(10,14,28,.45);
    --border: rgba(255,255,255,.14);
    --shadow: 0 18px 50px rgba(0,0,0,.35);
    --text:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,
    "Hiragino Kaku Gothic ProN","Yu Gothic","Noto Sans JP",sans-serif;
  background: #ffffff;   /* â† æœ€åˆã¯ç™½ */
  color:#111;
  overflow:hidden;
  transition: background 1s ease, color 1s ease;
  }
  body.night{
  background: linear-gradient(#0b1020, #1a2444);
  color:#fff;
  }

  .scene{
    position:relative;
    width:100%;
    height:100vh;
    height:100dvh;
  }

  /* ===== æ¡œï¼ˆèŠ±ã³ã‚‰ï¼‰ï¼šã¾ã£ã™ãè½ã¨ã™ ===== */
  .petals{
    position:absolute; inset:0;
    pointer-events:none;
    opacity: 0;                 /* â† æœ€åˆã¯è¦‹ã›ãªã„ */
    overflow:hidden;
  }
  .petal{
    position:absolute;
    top:-10vh;
    width:14px; height:10px;
    background: radial-gradient(circle at 30% 30%, #ffd1dc 0%, #ffb7c5 35%, #ff9fb2 70%, #ff8aa2 100%);
    border-radius: 80% 20% 80% 20%;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,.25));
    /* æ¨ªã«æºã‚‰ã•ãšã€ç¸¦ã«è½ã¡ã‚‹ï¼‹è»½ã„å›è»¢ã ã‘ */
    animation:
      fallStraight var(--fallDur) linear var(--delay) infinite,
      spin var(--spinDur) ease-in-out var(--delay) infinite;
  }

  
  @keyframes fallStraight{
    from{ transform: translateY(-10vh); }
    to  { transform: translateY(110vh); }
  }
  @keyframes spin{
    0%,100%{ rotate: 10deg }
    50%{ rotate: -18deg }
  }
  @media (prefers-reduced-motion: reduce){
    .petal{ display:none; }
  }

  /* ===== å†™çœŸã‚·ãƒ¼ã‚±ãƒ³ã‚¹ ===== */
  .stack{
    position:absolute;
    left:50%;
    top:14vh;
    transform: translateX(-50%);
    width:min(920px,92vw);
    display:flex;
    gap:14px;
    justify-content:center;
    align-items:stretch;
  }
  .photo{
    flex:1;
    min-width:0;
    aspect-ratio: 3 / 4;
    border-radius:18px;
    background: var(--card);
    border:1px solid var(--border);
    box-shadow: var(--shadow);
    overflow:visible; /* æ å¤–ãƒ©ãƒ™ãƒ«ã‚’å‡ºã™ã®ã§ visible */
    opacity:0;
    transform: translateY(12px);
    transition: opacity .9s ease, transform .9s ease;
    will-change: opacity, transform;
    position:relative;
  }
  .photo.show{ opacity:1; transform: translateY(0); }
  .photo.hide{ opacity:0; transform: translateY(16px); }

  .photo .frame{
    position:relative;
    width:100%; height:100%;
    border-radius:18px;
    overflow:hidden; /* ç”»åƒã¯æ å†…ã«åã‚ã‚‹ */
    background: var(--card);
    border:1px solid var(--border);
    box-shadow: var(--shadow);
  }

  .photo img{
    width:100%; height:100%;
    object-fit: cover;
    display:block;
    filter: saturate(1.05) contrast(1.02);
  }
  .photo .frame::after{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(to top, rgba(0,0,0,.28), transparent 50%);
    pointer-events:none;
  }

  /* ===== ãƒˆã‚³ãƒˆã‚³ï¼šå†™çœŸã®å¤–å´ï¼ˆæ å¤–ï¼‰ã«è¡¨ç¤º ===== */
  .photo .toko{
    position:absolute;
    left: 50%;
    top: calc(100% + 10px);          /* æ ã®å¤–å´ã«å‡ºã™ */
    transform: translateX(-50%) translateY(6px);
    padding: 8px 12px;
    border-radius: 999px;
    font-weight: 800;
    letter-spacing: .06em;
    /* èƒŒæ™¯ç³»ã‚’å‰Šé™¤ */
    /* background: rgba(0,0,0,.35); */
    /* border: 1px solid rgba(255,255,255,.18); */
    /* backdrop-filter: blur(8px); */
    /*  -webkit-backdrop-filter: blur(8px); */
    opacity: 0;
    transition: opacity .6s ease, transform .6s ease;
    white-space: nowrap;
  }
  .photo.show .toko{
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  .photo.hide .toko{
    opacity: 0;
    transform: translateX(-50%) translateY(8px);
  }
  /*show up sakura*/
  .petals.show{
    opacity: 1;
  }
  /* ===== å°ç­’ï¼ˆæ‰‹ç´™ï¼‰ï¼šç™½ã„å°ç­’ ===== */
  .letterWrap{
    position:absolute;
    left:50%;
    bottom:10vh;
    transform: translateX(-50%);
    width:min(520px,90vw);
    display:flex;
    justify-content:center;
    opacity:0;
    transform-origin:center;
    transition: opacity .8s ease, transform .8s cubic-bezier(.2,.8,.2,1);
  }
  .letterWrap.show{
    opacity:1;
    transform: translateX(-50%) translateY(0);
  }
  .envelope{
    width:100%;
    aspect-ratio: 16 / 10;
    position:relative;
    cursor:pointer;
    user-select:none;
    border-radius:22px;
    box-shadow: var(--shadow);
    outline:none;
  }

  .env-back{
    position:absolute; inset:0;
    background: rgba(255,255,255,.88);
    border: 1px solid rgba(0,0,0,.10);
    border-radius:22px;
  }
  .env-front{
    position:absolute; inset:0;
    border-radius:22px;
    overflow:hidden;
  }
  
  .env-front::before{
    content:"";
    position:absolute;
    left:0; top:0;
    width:100%;
    height:62%;
    background: rgba(0,0,0,.06);

    /* â–¼ è°·å‹ï¼ˆä¸‰è§’ãŒä¸‹ã«é–‹ãï¼‰ */
    clip-path: polygon(0 100%, 100% 100%, 50% 0);

    border-top-left-radius:22px;
    border-top-right-radius:22px;
    pointer-events:none;
  }

  .seal{
    position:absolute;
    left:50%; top:55%;
    transform: translate(-50%,-50%);
    width:64px; height:64px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #ffffff, #f2f2f2 70%, #e7e7e7);
    border:1px solid rgba(0,0,0,.10);
    box-shadow: 0 10px 25px rgba(0,0,0,.20);
    display:grid;
    place-items:center;
    font-weight:900;
    letter-spacing:.08em;
    color:#111;
  }
  .hint{
    position:absolute;
    left:50%;
    top:10%;
    transform:translateX(-50%);
    font-weight:800;
    color:#111;
    opacity:.88;
    text-align:center;
    width:90%;
    text-shadow:none;
  }
  .hint small{display:block; opacity:.70; font-weight:700; margin-top:.25em}

  .envelope:focus-visible{
    outline: 3px solid rgba(255,255,255,.55);
    outline-offset: 4px;
  }

  /* ===== é–‹å°å¾Œï¼š16:9 ã®ç™½ã„æ–°ç”»é¢ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ ===== */
  .overlay{
    position:fixed;
    inset:0;
    display:grid;
    place-items:center;
    background: rgba(0,0,0,.35);
    opacity:0;
    pointer-events:none;
    transition: opacity .35s ease;
  }
  .overlay.show{
    opacity:1;
    pointer-events:auto;
  }
  .paper169{
    width:min(92vw, 980px);
    aspect-ratio: 16 / 9;
    background:#fff;
    color:#111;
    border-radius:20px;
    box-shadow: 0 28px 80px rgba(0,0,0,.35);
    position:relative;
    overflow:hidden;
    transform: scale(.96);
    opacity:0;
    transition: transform .45s ease, opacity .45s ease;
  }
  .overlay.show .paper169{
    transform: scale(1);
    opacity:1;
  }

  /* é–‹å°æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªã‚­ãƒ©ãƒƒï¼‰ */
  .sparkle{
    position:absolute;
    inset:-20%;
    background:
      radial-gradient(circle at 20% 30%, rgba(255,255,255,.85), transparent 38%),
      radial-gradient(circle at 70% 60%, rgba(255,255,255,.65), transparent 42%),
      radial-gradient(circle at 45% 25%, rgba(255,255,255,.55), transparent 40%);
    opacity:0;
    transform: scale(.95);
    pointer-events:none;
  }
  .overlay.show .sparkle{
    animation: sparkleIn .55s ease forwards;
  }
  @keyframes sparkleIn{
    0%{opacity:0; transform:scale(.95)}
    40%{opacity:.85}
    100%{opacity:0; transform:scale(1.05)}
  }

  .paperInner{
    position:absolute;
    inset:0;
    padding: 26px 26px;
    display:flex;
    flex-direction:column;
    gap:14px;
  }
  .paperTitle{
    margin:0;
    font-size: clamp(18px, 2.6vw, 26px);
    letter-spacing:.02em;
  }
  .paperText{
    flex:1;
    font-size: clamp(16px, 2.2vw, 20px);
    line-height:1.75;
    white-space:pre-wrap;
    overflow:auto;
    padding-right:6px;
  }
  .paperActions{
    display:flex;
    justify-content:center;
    gap:10px;
  }
  .paperActions button{
    border:0;
    padding:10px 14px;
    border-radius:999px;
    background:#111;
    color:#fff;
    font-weight:800;
    cursor:pointer;
  }
</style>
</head>
<body>
<div class="scene" id="scene">
  <div class="petals" id="petals" aria-hidden="true"></div>

  <div class="stack" aria-label="å†™çœŸã‚¹ãƒ©ã‚¤ãƒ‰">
    <div class="photo" id="p1">
      <div class="frame">
        <img src="assets/photo1.jpg" alt="photo 1">
      </div>
      <div class="toko">ãƒˆã‚³ãƒˆã‚³</div>
    </div>

    <div class="photo" id="p2">
      <div class="frame">
        <img src="assets/photo2.jpg" alt="photo 2">
      </div>
      <div class="toko">ãƒˆã‚³ãƒˆã‚³</div>
    </div>

    <div class="photo" id="p3">
      <div class="frame">
        <img src="assets/photo3.jpg" alt="photo 3">
      </div>
      <div class="toko">ãƒˆã‚³ãƒˆã‚³</div>
    </div>
  </div>

  <div class="letterWrap" id="letterWrap">
    <div class="envelope" id="envelope" role="button" tabindex="0" aria-label="æ‰‹ç´™ã‚’é–‹ã">
      <div class="env-back"></div>
      <div class="env-front"></div>
      <div class="seal">OPEN</div>
      <div class="hint" id="hint">
        æ‰‹ç´™ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é–‹ã„ã¦ã­
        <small>aaaaa</small>
      </div>
    </div>
  </div>
</div>

<!-- é–‹å°å¾Œã®ç™½ã„16:9ç”»é¢ -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="paper169" role="dialog" aria-label="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
    <div class="sparkle"></div>
    <div class="paperInner">
      <h1 class="paperTitle" id="paperTitle">Message</h1>
      <div class="paperText" id="paperText"></div>
      <div class="paperActions">
        <button type="button" id="closeOverlay">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>
</div>

<script>
  // ===== å¥½ãã«æ›¸ãæ›ãˆã‚‹å ´æ‰€ =====
  const MESSAGE = "ğŸ‰ ã‚ã‘ã¾ã—ã¦ãŠã‚ã§ã¨ã†ï¼\n\nä»Šå¹´ã‚‚ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚\nå¥åº·ã§è‰¯ã„ä¸€å¹´ã«ãªã‚Šã¾ã™ã‚ˆã†ã«ã€‚";
  const SIGN    = "â€” K ã‚ˆã‚Š"; // ä¸è¦ãªã‚‰ ""
  const TITLE   = "New Year Letter";
  const PHOTO_DELAY = 2000;   // å†™çœŸãŒå‡ºã‚‹é–“éš”ï¼ˆmsï¼‰
  const VISIBLE_MS  = 2200;   // è¡¨ç¤ºã—ã¦ã„ã‚‹æ™‚é–“ï¼ˆmsï¼‰
  const PETAL_COUNT = 26;     // èŠ±ã³ã‚‰é‡ï¼ˆç«¯æœ«ãŒé‡ã‘ã‚Œã°ä¸‹ã’ã‚‹ï¼‰
  // ===============================

  // æ¡œã‚’ç”Ÿæˆï¼ˆã¾ã£ã™ãè½ä¸‹ï¼‰
  const petals = document.getElementById("petals");
  if(!matchMedia("(prefers-reduced-motion: reduce)").matches){
    for(let i=0;i<PETAL_COUNT;i++){
      const p=document.createElement("div");
      p.className="petal";
      // ä½ç½®ã¯æ¨ªã ã‘ãƒ©ãƒ³ãƒ€ãƒ ã€‚è½ã¡ã¯ç¸¦ã®ã¿ã€‚
      p.style.left = (Math.random()*100) + "vw";
      p.style.setProperty("--fallDur", (8 + Math.random()*10) + "s");
      p.style.setProperty("--spinDur", (2.8 + Math.random()*2.6) + "s");
      p.style.setProperty("--delay", (-Math.random()*10) + "s");
      p.style.opacity = (0.45 + Math.random()*0.4).toFixed(2);
      p.style.transform = `scale(${(0.7+Math.random()*1.2).toFixed(2)})`;
      petals.appendChild(p);
    }
  }

  // å†™çœŸï¼šè¦ç´ å–å¾—
  const p1 = document.getElementById("p1");
  const p2 = document.getElementById("p2");
  const p3 = document.getElementById("p3");
  const letterWrap = document.getElementById("letterWrap");

  // åˆæœŸåŒ–
  [p1,p2,p3].forEach(el => el.classList.remove("show","hide"));

  function showThenHide(el, showDelay, visibleMs = VISIBLE_MS){
    setTimeout(() => {
      el.classList.add("show");
      el.classList.remove("hide");
    }, showDelay);

    setTimeout(() => {
      el.classList.add("hide");
      el.classList.remove("show");
    }, showDelay + visibleMs);
  }

  // å³ã‹ã‚‰é †ã«è¡¨ç¤ºï¼šp3 â†’ p2 â†’ p1
  showThenHide(p3, 200);
  showThenHide(p2, 200 + PHOTO_DELAY);
  showThenHide(p1, 200 + PHOTO_DELAY*2);

  // æ‰‹ç´™ã¯æœ€å¾Œã«å‡ºã™
  setTimeout(() => {
  letterWrap.classList.add("show");

  // èƒŒæ™¯ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
  document.body.classList.add("night");

  // æ¡œã‚’è¡¨ç¤ºé–‹å§‹
  document.getElementById("petals").classList.add("show");
  }, 200 + PHOTO_DELAY*3);


  // ===== é–‹å°å¾Œã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆç™½ã„16:9ï¼‰ =====
  const overlay = document.getElementById("overlay");
  const envelope = document.getElementById("envelope");
  const paperText = document.getElementById("paperText");
  const paperTitle = document.getElementById("paperTitle");
  const closeOverlay = document.getElementById("closeOverlay");
  const hint = document.getElementById("hint");

  paperTitle.textContent = TITLE;
  const fullText = SIGN ? (MESSAGE + "\n\n" + SIGN) : MESSAGE;

  function typewriter(el, text, ms=18){
    el.textContent = "";
    let i = 0;
    const id = setInterval(() => {
      el.textContent = text.slice(0, ++i);
      if(i >= text.length) clearInterval(id);
    }, ms);
    return id;
  }

  let opened = false;
  let typingId = null;

  function openLetter(){
    if(opened) return;
    opened = true;
    hint.style.display = "none";
    overlay.classList.add("show");
    overlay.setAttribute("aria-hidden","false");
    typingId = typewriter(paperText, fullText, 18);
  }

  function closeLetter(){
    opened = false;
    if(typingId) clearInterval(typingId);
    overlay.classList.remove("show");
    overlay.setAttribute("aria-hidden","true");
    hint.style.display = "";
    paperText.textContent = "";
  }

  envelope.addEventListener("click", () => openLetter());
  envelope.addEventListener("keydown", (e) => {
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      openLetter();
    }
  });

  closeOverlay.addEventListener("click", (e) => {
    e.stopPropagation();
    closeLetter();
  });

  overlay.addEventListener("click", (e) => {
    // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ï¼ˆç´™ã®ä¸Šã¯é™¤å¤–ï¼‰
    if(e.target === overlay) closeLetter();
  });

  document.addEventListener("keydown", (e) => {
    if(e.key === "Escape" && opened) closeLetter();
  });
</script>
</body>
</html>







